# CURSOR RULES & PROJECT CONTEXT

## ðŸš¨ CRITICAL SAFEGUARDS (ALWAYS FOLLOW)

1. **Destructive Commands**: **NEVER** run `supabase db reset`, `supabase db push`, `rm -rf`, or `git push --force` without explicit user confirmation.
2. **Database Operations**:
   - **NO Local Commands**: Do not use `supabase db` CLI locally.
   - **Use MCP Tools**: Use `mcp_supabase_*` tools to query/modify the remote DB.
   - **RLS Safety**: ALWAYS query `pg_policies` before dropping. Use EXACT names. Check for circular dependencies.
3. **Clavix Agents**:
   - **Planning Mode**: No code allowed.
   - **Implementation Mode**: Code allowed.
   - *Ref: `.clavix/instructions/workflows/`*

---

## ðŸ—ï¸ PROJECT: GIGMASTER (Context & Architecture)

**Goal**: A dedicated "gig brain" OS for musicians.
**Philosophy**: Clear domain models, separation of concerns, performance-first.

### 0. Tech Stack
- **Frontend**: Next.js (App Router), React, TypeScript, Tailwind, **shadcn/ui** (Mandatory).
- **Backend**: Supabase (Postgres, Auth, Storage, RLS).
- **Data**: TanStack Query + Supabase JS Client / Route Handlers.
- **Mobile**: Expo (React Native) - future integration. Shared types/logic required.

### 1-3. Core Domain & Entities
- **Personas**: Musician (Player), MD (Leader), Agency, Hybrid.
- **Entities**: 
  - `User`: Musician/Manager.
  - `Project`: Band/Act.
  - `Gig`: Event (date, time, location).
  - `GigRole`: Slot (e.g., "Keys") + Status (Invited/Accepted) + Pay.
  - `Setlist`: Songs + Attachments.

### 4. Key Workflows
1. **Data/UI**: Basic CRUD for Gigs/Projects.
2. **Views**: "As Player" (My Gigs) vs "As Manager" (My Projects).
3. **Gig Pack**: The "One Sheet" (Logistics, Music, People, Money).
4. **Money**: Financial tracking per gig/role.

### 6. Architecture & Performance Checklist
- **Queries**: Fetch ONLY needed fields. No `SELECT *`.
- **Lists**: Use pagination/infinite scroll. Limit queries.
- **Indexes**: Ensure `userId`, `projectId`, `gigId`, `date` are indexed.
- **UI**: Use skeletons/loading states. No "god components".
- **Separation**: Keep `lib/api` separate from UI components.

---

## ðŸ› ï¸ DEVELOPMENT PROTOCOLS

### 1. Architectural Changes (7-Step Check)
**Trigger**: Changing schemas, types, or APIs.
1. **Search**: `grep` for the old name/property globally.
2. **Document**: List all occurrences (DB, Types, API, UI).
3. **Fix Layers**: DB -> Types -> API -> Components -> Pages.
4. **Verify**: Lint, Type-check, Grep again (target 0 results).

### 2. Documentation Requirement
- **Workflow**: Finish Feature -> Create Docs -> Mark Complete.
- **Template**: `/docs/build-process/TEMPLATE.md`.
- **Location**: `/docs/build-process/step-X-[name].md`.

### 3. Coding Standards
- **Simple**: Avoid over-engineering.
- **Clean**: Files < 300 lines. Refactor if larger.
- **Safe**: No mocking in dev/prod.
- **Context7**: Use `context7` MCP to fetch library docs before coding.
